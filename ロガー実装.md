とりあえず河川に実装->チェックもらう
藤原さんチェック
- 送信内容と受信内容は分けて出力
- $http_response_headerを全部出力する
　- 配列を順番に出力するのをfor文以外で実装する

やりたいこと：配列の中身を一つづつ取りだして（ひとつの文字列型変数にする）
- array_walk()またはarray_map()を使って、各配列に共通の関数を通す

- 感覚：array_walk()を使ったほうが良さそう
- 問題：functionが見つからないと言われる
　- コールバック関数についての見識が足りない
    - コールバック関数　＝　引数として渡す関数
- 藤原さん：「ログ出せるようにするのが最優先」
  ->foreachで実装、あとで改良
- 定数`PHP_EOL` 改行コード　実行環境に合わせて最適なものを定義される
- [x] 送受信内容をlogるの横展開

- [x] 例外をlogる
  - [x] 問題：BatchBaseのgetLoggerはprotectedなのでDaoからアクセスできない
    - アプローチ：protectedからpublicに変える
      - オブジェクトにしないといけない（BatchBase内で$thisで呼び出すためには）
      - インスタンス化するには引数が足りない（コンテナとか持ってこなきゃいけない
    - アプローチ：他クラスからアクセスできるgetLoggerはないか？
      - BatchBase->getLogger()はcontainer['logger']を返しており、これはdependenciesにある
      - container['logger']の中身は関数であり、$loggerを返している
      - 関数内に$logger = new \Monolog\Logger($settings['name']);と定義されている
    - ◎アプローチ：Daoのcatch文で例外をスローし、Actionクラスでその例外をキャッチしログを吐く
      - できました（11:00ごろ）
      - 問題：初期化先の変数になにも入ってない
        - 対応：とりあえずarray()いれといてた
  - 例外吐いたときの全体の流れ
    - 処理を中断(return false;)
    - その時間帯に本来送られる／作られるデータは次のように処理
      - 直近->欠測扱い、sendテーブルに手入力する
      - 欠測再取得->つぎの実行で取得
    - 未送信->次の実行で取得
- 単体テスト
  - 問題：ケース003と004で想定と違う挙動
  - 003と004はともに欠測発生ケース
  - 欠測発生時にデータが作成されていない
  - 原因：観測所コードのデータが存在しない
    - 解決：他機能と同様に観測所コードを入れる
    - 修正：ケース004が正時じゃないのに時間データを期待している
  - 2020/11/05 17:53 OK

    
 
