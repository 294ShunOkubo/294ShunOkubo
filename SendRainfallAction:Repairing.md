# BOUSAI-27 雨量データ送信（実装）：修正

## 修正すべき点
- [x] テスト用の固定時刻消す
- [x] 水位のコピペのままになっているソースを雨量仕様に直す
    - [x] オブジェクト化する際の変数名をriverからrainに変える
    - [x] 正時で60分間の雨量を積算するよう修正
    - [x] selectMostRecent($from, $to)をもう使わないか検討
        - めっちゃ使うことが判明
    - [x] その他水位の名残がないかチェック
        - [x] 「水位」で検索
        - [x] waterで検索
- [x] 他機能で共通化した仕様を雨量にも同期
    - [x] defineをクラス外に出す
    - [x] echo $contents を削除
    - [x] str_replace('-', '/', $key['observTime'])は$master_for_jsonで一括でやる
    - [x] keyを消すときはできるだけarray_slice()を使わずunset()を使う
    - [x] まず時間で取得して観測所ごとに分ける
    - [x] 'observ_time'を'observing_time'に変更
- [x] valueが小数から整数になったことへの対応
    
## 雨量のポイント
- 10分データと時間データで扱うデータの範囲が違う
- 水位：select()で時間で取ってきてからprocessForAPI()で観測所ごとに分ける
- 雨量（現状）：観測所ごとに取得を観測所の数だけ繰り返す
    - 変更した
- 観測日時は送信機能が発動した日時
    - 問題：直近（現在時刻）と欠測（DBにある観測日時）で変わる
        - 解決：とりあえず現在時刻入れて、欠測時のみあとから書き換え

## 正時で60分間の雨量を積算するよう修正
- まず10分間の雨量をつくる
    - 日付取得
    - getTimes()で取得範囲特定に必要な時間データを算出
        - ここで10分版と60分版と両方作れるようにする
- 正時であれば、60分間の雨量をつくる

## 動作確認
- 想定実行時刻：2020-10-02 15:05:00
- 10分が10ミリ、60分が60ミリとれてればとりあえずOK
- OKそう

## ブランチ変えよう
- [x] 変更対象ファイルを退避
