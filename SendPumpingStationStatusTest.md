## 藤原さん：テストケースコメント変えていいですか？
  - 結論：いいよ
  - でもガチで整えたら時間かかるのでは？
  - ほな後回しにします

## タスク：ケース001うまいこと動かしてテストの土台を整える
  - 対応：Actionクラスをテスト仕様に
  - actualに余計なもん載せがち（db_idとか）
    - 要因：array_sliceが機能していない
    - 対応：デバッグしてこの付近の挙動を調べる
      - 問題：unset($key)で当該要素消えてくれない
        - 解決：unset($column[$key])
      - 解決：array_sliceではなく$keyを回して消したいキーを検知、削除
  - expectedのobservPointCodeをIDに変更（API仕様書より）
  - 発見：jsonにstatusを入れなくなったのでinsert用の送信テーブルを作るときに期待jsonを使えなくなった
  　->カラムによって欠測か否かが変わるやつだるい
      - それ用の配列作って回す？
  - 解決：ケース001無事動きました

## ケース002
  - unset()忘れで事故
  - 期待：null　実際：0
  - 問題：nullあるやつunsetできてない→要調査
    - 要因：nullであるべきところ（master_for_json）、0.00になってる
      - 要因：csvから取り込んだときnullと埋めたところが0.00になってる
        - 要因：fgetcsv()の仕様で、csvから取り込んだ値ひとつひとつは全て文字列型として扱われる
        - 対応：文字列"null"を検知して明示的にnullを代入する
  - 問題：各値をキャストする処理とnullを弾く処理、どちらを先にしても問題がある
    - キャストが先=>nullをキャストすると0になり区別がつかなくなる
    - 削除が先=>キャスト対象のキーがない旨のエラーが出る
    - 解決：キャストが先、ただしキャスト前にnullチェックを追加
    - 
  - 問題：送信テーブルinsert分結果作成、文字列キャスト時nullがエラー
    - 解決：isnull() ? null ? キャスト　の三項演算子
    - 上記のnullチェックも三項演算子に変更
  - OK：15:00頃

## ケース003
  - 問題：観測所00001は欠測につきjsonでは送らないので、sendテーブル用の結果を作るのに流用できない
    - 解決：jsonに載せないものも$expected_resultsに一回載せて、先にDBの期待結果を作った後
            送らないデータをunsetしてオブジェクト化、期待値として登録
  - 問題：$expected_resultsの配列番号が合わない
    - 期待：1,2,4,5
    - 実際：0,1,3,4,
    - 解決：元の期待の配列内の順番を変えた（欠測分を最後にした）
  - 問題：項目によって期待status_cdが違う
    - 配列を作りました（上記参照）
  - OK 16:10
  
## ケース004
  - OK 16:30
  
## ケース005
　- OK 16:45
 
## ケース006
　- 注意：ここから更新/非更新/新規挿入を分けていく
  - 実行タイム：2020-10-02 15:11:00
    - 更新：更新したくて無事更新できました
    - 非更新：更新したかったけど無理でした組
    - 新規：普通に1500～1510のやつ
  - OK 17:17
  
## ケース007
　[] todo：send.csvの値、1.1から欠測状態にする
  - 欠測分の日付、10/31で統一
  - 問題：なぜかUndefined
    1) SendPumpingStationStatusTest::testCase007
    Undefined index: observTime

    C:\Users\pc-000491\weather\src\Action\SendPumpingStationStatusAction.php:94
    C:\Users\pc-000491\weather\tests\Functional\SendPumpingStationStatusTest.php:962
    - 解決：DB側の'id'が'ID'に
    　- 要因：一斉置換か手直し時に巻き込まれた
    　- 解決してない（同じ症状が出る）
    - 要因：$api_masterに意図しない要素が入っていて、その要素の配列にobservTimeがない
      - 問題：23:30のデータは入っているが、23:48のデータが入っていない
        - 解決：send.csvの日付、2020-10-02になってた
      - 問題：順番がおかしい
        - 解決：「更新されるカラム」の期待値書き換える
  - OK：2020-10-21 13:40
  
## ケース008
  - OK：14:03
  
## ケース009
　- OK：14:27
 
## ケース010
  - 50分台：直近
  - 40分台：欠測復活
  - 30分台：未送信
  - OK：14:56
  
## ケース007に必須以外全部null入れるの巻
  - dataUpload()書き換え、以下のやり方に
    $stmt->bindParam(':flooding', $line2, $line2 == "null" ? PDO::PARAM_NULL : PDO::PARAM_STR);
  - OK：15:30ごろ

## ケース009に（ｒｙ
  - 問題：selectNotSent()から未送信データを取得するときにnullが0になってしまう
    - そもそも：send.csvからデータ入れたときにnullが0になってる説
    - 試行：010コメント合うとして実行、007のDB状態にする
    - 解決：send.csvのスペース詰めてなかった
  - OK：16:05

## 確認＆仕上げ
  - dataUploadObservPoint()をSetUp()内に移動、呼び出しが1回だけに
  - 問題：ケース003、rain_water_pumpが欠測に付きnullだったとき0が入ってる問題
  　- 要因：欠測時''やらを入れてる
    - 解決：欠測時にnullを入れる
    - 要因：$expected_resultsを文字列にキャストするとき、is_nullの三項演算子入れる
  
